<div class="page_header_container">
    <div class="page_header">
        <div class="left page_action_container">
            <a ui-sref="organizations" class="page_action"><i class="fa fa-chevron-left"></i> {$:: 'Organizations' | translate $}</a>
        </div>
        <div class="page_title">
            <h1>{$:: org.name $}</h1>
        </div>
        <div class="right page_action_container">
        </div>
    </div>
</div>
<div class="section_nav_container">
    <div class="section_nav" ng-include="::urls.static_url + 'seed/partials/accounts_nav.html'"></div>
</div>
<div class="section">
    <div class="section_header_container">
        <div class="section_header fixed_height_short">
            <div class="left section_action_container">
                <h2><i class="fa fa-bar-chart"></i> {$:: 'Analyses' | translate $} - {$:: analysis.name $}</h2>
            </div>
        </div>
    </div>
    <div class="section_content_container">
        <div class="section_content">
            <div class="table_list_container">
                <table id="analyses-table" class="table table-striped table_highlight_first">
                    <thead>
                        <tr>
                            <th translate>Number of Properties</th>
                            <th translate>Type</th>
                            <th translate>Run Status</th>
                            <th translate>Latest Message</th>
                            <th translate>Run Date</th>
                            <th translate>Run Duration</th>
                            <th translate>Run Author</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{$:: analysis.number_of_analysis_property_views $}</td>
                            <td>{$:: analysis.service $}</td>
                            <td class="analysis-status {$:: analysis.status.toLowerCase() $}">{$:: analysis.status $}</td>
                            <td>{$:: (messages | filter : {'analysis_property_view':''})[0]['user_message'] $}</td>
                            <td>{$:: analysis.start_time | date : 'MM-dd-yyyy  HH:mm' $}</td>
                            <td>{$:: analysis | get_run_duration $}</td>
                            <td>{$:: users | filter : {'user_id':analysis.user} | getAnalysisRunAuthor $}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table_list_container">
                <table id="analyses-table" class="table table-striped table_highlight_first">
                    <thead>
                        <tr>
                            <th translate>Run ID</th>
                            <th translate>Property Address</th>
                            <th translate>Latest Message</th>
                            <th translate>Output Files</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="view in views | filter:filter_params:strict">
                            <td>{$:: view.id $}</td>
                            <td>{$:: view.property_state.extra_data['Address'] $}</td>
                            <td>{$:: (messages | filter : {'analysis_property_view':view.id})[0]['user_message'] $}</td>
                            <td>
                                <span ng-repeat="file in view.output_files | filter:filter_params:strict">
                                    <a href="{$:: file.file $}">{$:: file.content_type $}</a>
                                    <span ng-repeat-end ng-if="!$last">,&nbsp;</span>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
